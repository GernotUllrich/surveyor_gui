<% stylesheet_link_tag 'colorbox.css' -%>
<% stylesheet_link_tag 'surveyor/ui.slider.extras.css' -%>
<% javascript_include_tag 'surveyor/selectToUISlider.jQuery.js' -%>
<% javascript_include_tag 'jquery.rating.js' %>
<% stylesheet_link_tag 'jquery.rating.css' -%>
<div id="Box" class="boxshadow round">
  <div class="column3">
    <input id='pass_cbox_data' type="hidden">
    <div class="shadebox round">
      <div id="survey">
        <h1 class="round-top">
          <%= @title %>
            <% if @surveyform.id -%>
              <%= button_to_function 'Preview Survey',
                  'cbox = $.colorbox({width:"90%",
                      height:"90%",
                      scrolling:true,
                      iframe:true,
                      href:"'+preview_survey_surveyresponse_url+'?suppress_header=true&survey_id='+@surveyform.id.to_s+'", opacity:.3});',
                      :style=>'position: relative; left:47%; top:0' %>
              <%= button_to_function 'Preview Results',
                  'cbox = $.colorbox({width:"90%",
                      height:"90%",
                      scrolling:true,
                      iframe:true,
                      href:"'+preview_results_surveyresponse_url+'?suppress_header=true&survey_id='+@surveyform.id.to_s+'", opacity:.3});',
                      :style=>'position: relative; left:47%; top:0' %>
              <%= button_to_function 'Preview Report',
                  'cbox = $.colorbox({width:"90%",
                      height:"90%",
                      scrolling:true,
                      iframe:true,
                      href:"'+preview_report_surveyresponse_url+'?suppress_header=true&survey_id='+@surveyform.id.to_s+'", opacity:.3});',
                      :style=>'position: relative; left:47%; top:0' %>
            <% end %>
        </h1>
        <%= simple_form_for @surveyform, :url => "/surveyforms/"+@surveyform.id.to_s do |f| %>


           <% @surveyform.errors.full_messages.each do |msg| %>
              <p><%= msg %></p>
           <% end %>
          <br/>
          <%= f.hidden_field :id %>
          <%= f.label :title, :required => false,  :style => 'font-size: 150%;' %>
          <%= f.input :title, :input_html => { :size => '35', :style=>'margin-top: 0.5%; font-size: 110%; float:left;'}, :required=>false , :label=>false%>
          <%= f.input :template, :label => false, :input_html=>{:style=>"float:right;"} %><span style='position:relative; float: right;'>Template?&nbsp;

          </span><br/><br />
          <div class="sortable_sections">
            <%= render "survey_section_fields", :s => builder , :f => f %>
          </div>
          <p><%= f.button :submit,  'Save Changes' %></p>
        <% end %>
      </div>
    </div>
  </div>
</div>
  <% content_for :javascript do %>

    <% javascript_tag do %>

      $(document).ready(function() {
            $('.sortable_sections').sortable({
              axis:"y",
              opacity: 0.6,
              scroll: true,
              update: function(){
                $.ajax({
                  type: 'post',
                  data: $('.sortable_sections').sortable('serialize')+'&survey_id=<%=@surveyform.id %>',
                  dataType: 'script',
                  complete: function(request){
                  $('#survey_section').effect('highlight');
                },
                url: '/survey_sections/sort'})
              }
            });

            $('.sortable_questions').sortable({
              axis:"y",
              opacity: 0.6,
              scroll: true,
              connectWith: ".sortable_questions",
              update: function(){
                $.ajax({
                  type: 'post',
                  data: getAllSerialize()+'&survey_id=<%=@surveyform.id %>',
                  dataType: 'script',
                  complete: function(request){
                  $('#survey_section').effect('highlight');
                  update_question_numbers();
                },
                url: '/questions/sort'})
              }


            });

      });

      function getAllSerialize() {
        $('.sortable_questions').each(function(index, value) {
          if (index === 0) {
            newarr = $(this).sortable('serialize',{key:$(this).attr('id')+'[]'});
          }
          else{
            newarr = newarr+'&'+$(this).sortable('serialize',{key:$(this).attr('id')+'[]'});
          }
        });
        return newarr;
      }



    <% end %>
  <% end %>
